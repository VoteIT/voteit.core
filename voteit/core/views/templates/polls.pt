<tal:main xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="voteit.core">

    <tal:iterate condition="polls" repeat="poll polls">
    <div tal:define="poll_plugin poll.get_poll_plugin()|None;
                     wf_state poll.get_workflow_state();
                     unread api.is_unread(poll);
                     can_vote api.context_has_permission('Add Vote', poll);
                     has_voted api.userid in poll;"
         tal:attributes="class unread and 'unread listing_block poll ' + poll.poll_plugin_name or 'listing_block poll ' + poll.poll_plugin_name;
                         name poll.__name__;">

        <span tal:condition="api.show_moderator_actions" tal:replace="structure api.get_moderator_actions(poll, request)">
             Cogwheel menu
        </span>

		<h3 tal:content="poll.title">Title</h3>

        <div class="col-65-35">
            <div class="column column-1">
                <div class="description"
                	 tal:condition="wf_state != 'closed'"
                     tal:content="structure poll.description">
	                     Description</div>
				<div class="result" 
					tal:condition="wf_state == 'closed'"
		            tal:content="structure poll.render_poll_result(request, complete=False)">
		        	    Poll result</div>
            </div>
            <div class="column column-2">
            	<div tal:content="structure api.get_poll_state_info(poll)">Poll state info</div>
            </div>
        </div>

		<div class="clear"><!-- --></div>
		
		<tal:poll_open condition="wf_state != 'closed'">				
		<div tal:condition="can_vote and not has_voted">
            <a href="${api.resource_url(poll, api.request)}" class="poll_booth buttonize" i18n:translate="">add_vote_button</a>
        </div>
        <div tal:condition="not can_vote and wf_state == 'ongoing'" i18n:translate="">
			You do not have the permission to vote in this poll,
			please contact the moderator if you should be able to vote.
        </div>
        <div tal:condition="can_vote and has_voted">
        	<span i18n:translate="">You have already votet. You can change your vote</span> <a href="${api.resource_url(poll, api.request)}" class="poll_booth" i18n:translate="">here</a>
        </div>
		</tal:poll_open>
		<tal:poll_closed condition="wf_state == 'closed'">
			<a href="${api.resource_url(poll, api.request)}" class="poll_booth buttonize" i18n:translate="">View details and your vote</a>
		</tal:poll_closed>
		
    </div>
    </tal:iterate>
    
</tal:main>
