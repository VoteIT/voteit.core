<tal:main xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="voteit.core">

    <tal:iterate condition="polls" repeat="poll polls">
    <div tal:define="poll_plugin poll.get_poll_plugin()|None;
                     wf_state poll.get_workflow_state();
                     unread api.is_unread(poll);
                     can_vote api.context_has_permission('Add Vote', poll);
                     has_voted api.userid in poll;"
         tal:attributes="class unread and 'unread listing_block poll ' + poll.poll_plugin_name or 'listing_block poll ' + poll.poll_plugin_name;
                         name poll.__name__;">
		
		<div class="listing">
			<div>
		        <span tal:condition="api.show_moderator_actions" tal:replace="structure api.get_moderator_actions(poll, request)">
		             Cogwheel menu
		        </span>
			</div>
	
	        <h3 tal:content="poll.title">Title</h3>
	
	        <div class="col-65-35">
	            <div class="column column-1">
	                <div class="description"
	                     tal:content="structure poll.description">Description</div>
		             <div tal:condition="wf_state == 'closed'"
		             	  tal:content="structure poll.render_poll_result(request)"
		             	  class="result">
		        	    Poll result
				    </div>
	            </div>
	            <div class="column column-2">                
	                <div tal:content="structure api.get_poll_state_info(poll)">Poll state info</div>
	            </div>
	        </div>
	
			<div class="clear"><!-- --></div>
	
			<tal:poll_open condition="wf_state != 'closed'">				
			<div tal:condition="can_vote and not has_voted">
	            <a href="${api.resource_url(poll, api.request)}" class="poll_booth buttonize" i18n:translate="">add_vote_button</a>
	        </div>
	        <div tal:condition="not can_vote and wf_state == 'open'" i18n:translate="">
				You do not have the permission to vote in this poll, please contact the moderator if you should.
	        </div>
	        <div tal:condition="has_voted" i18n:translate="">
	        	You have already votet. You can change your vote here
	            <a href="${api.resource_url(poll, api.request)}" class="poll_booth buttonize" i18n:translate="">add_vote_button</a>
	        </div>
			</tal:poll_open>

	        <div tal:condition="wf_state == 'closed'" class="listing">
	    		<a href="${api.resource_url(poll, api.request)}" class="poll_booth buttonize" i18n:translate="">View details and your vote</a>
	        </div>
	        	
	    </div>
    	<div class="booth">
			<h3 tal:content="poll.title">Title</h3>
	
	        <div class="col-65-35">
	            <div class="column column-1">
	            	<div tal:content="structure api.get_poll_state_info(poll)">Poll state info</div>
	                <div class="description"
	                     tal:content="structure poll.description">Description</div>
		             <div tal:condition="wf_state == 'closed'"
		             	  tal:content="structure poll.render_poll_result(request)"
		             	  class="result">
		        	    Poll result
				    </div>
	            </div>
	            <div class="column column-2">
					<div class="poll_type">
	                    <strong i18n:translate="">Poll method</strong>: <span tal:content="poll_plugin.title|string:Broken plugin">Title</span>
	                    <div tal:content="structure poll_plugin.description|string:">Description</div>
	                </div>
	            </div>
	        </div>
	
			<div class="clear"><!-- --></div>
	        
	        <tal:user_voted condition="has_voted and poll_plugin">
	            <div id="users-vote-${poll.uid}">
	                <div tal:condition="poll_forms[poll.uid]|False">
	                    <h3 i18n:translate="">You've voted</h3>
	                    <div tal:condition="wf_state == 'ongoing'"
	                         class="listing_block"
	                         i18n:translate="">If you submit the form again, you'll change your vote. You may do that as long as the poll is open.</div>
	                    <div tal:content="structure poll_forms[poll.uid]">Render your vote</div>
	                </div>
	            </div>
	        </tal:user_voted>
	        <tal:user_not_voted condition="not has_voted">
	            <div tal:condition="poll_forms[poll.uid]|False" tal:content="structure poll_forms[poll.uid]"></div>
	        </tal:user_not_voted>
	    </div>
    </div>
    </tal:iterate>
    
</tal:main>
