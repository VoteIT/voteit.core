<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="api.main_template.macros['master']"
	  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	  i18n:domain="voteit.core">
<body>

    <div id="content" metal:fill-slot="top_content">
        <div id="polls">
            <div id="add_poll">
                <a class="buttonize" tal:attributes="href api.resource_url(context, request) + '@@add?content_type=Poll'"><span i18n:translate="">Add poll</span></a>
            </div>
            <h2><span i18n:translate="">Poll(s)</span>
                <!-- FIXME: this is just a dummy for showing the feature -->
                <a tal:attributes="id string:help_${context.uid};" href="@@help?article=dummy" target="_blank" class="help">?</a>
            </h2>
            <tal:iterate condition="polls" repeat="poll polls">
                <div tal:define="poll_plugin poll.get_poll_plugin();
                                 state_id poll.get_workflow_state();
                                 unread api.is_unread(poll, True);"
                     tal:attributes="class unread and 'unread listing_block' or 'listing_block'">
                    <div class="poll_type">
                        <strong i18n:translate="">Poll method</strong>: <span tal:content="poll_plugin.title">Title</span>
                        <div tal:content="structure poll_plugin.description">Description</div>
                    </div>
                    <h3 tal:content="poll.title">Title</h3>
                    <div class="wf-info">
                        <span i18n:translate="">State</span>:
                        <strong tal:attributes="class 'wf-state-%s' % state_id"
                                tal:content="state_id">open</strong>
                    </div>
                    <div tal:content="poll.description">Description</div>
                    
                    <div tal:condition="state_id == 'closed'"
                        tal:content="structure poll.render_poll_result()">
                        Poll result
                    </div>
                    <div tal:condition="state_id == 'private'" tal:define="proposals poll.get_proposal_objects()">
                    <tal:iterate condition="proposals" repeat="proposal proposals" >
                        <div class="proposal">
                            <strong tal:content="structure proposal.title"></strong>
                            <tal:creators tal:replace="structure api.get_creators_info(proposal.creators, request)">Creators</tal:creators>
                        </div>
                    </tal:iterate>
                    </div>

                    <div tal:replace="structure api.get_action_bar(poll, request)">Action bar</div>
                    <div tal:condition="poll_forms[poll.uid]|False" tal:content="structure poll_forms[poll.uid]"></div>
                </div>
            </tal:iterate>
            <tal:no_polls condition="not polls">
                <h3 i18n:translate="">No polls yet</h3>
            </tal:no_polls>
        </div> <!-- polls -->
    </div> <!-- top_content -->
        

    <div id="content" metal:fill-slot="right_content">
        <div id="discussions">
            <h2><span i18n:translate="">Discussion</span>
                <!-- FIXME: this is just a dummy for showing the feature -->
                <a tal:attributes="id string:help_${context.uid};" href="@@help?article=dummy" target="_blank" class="help">?</a>
            </h2>
                
            <div tal:replace="structure get_discussions()"></div>

            <div tal:condition="discussion_form|False" tal:replace="structure discussion_form">Discussion form</div>
        </div>
    </div> <!-- right_content -->

    <div id="content" metal:fill-slot="left_content">
        <div id="proposals">
            <h2><span i18n:translate="">Proposal(s)</span>
                <!-- FIXME: this is just a dummy for showing the feature -->
                <a tal:attributes="id string:help_${context.uid};" href="@@help?article=dummy" target="_blank" class="help">?</a>
            </h2>
            <tal:iterate condition="proposals" repeat="proposal proposals" >
                <div tal:define="unread api.is_unread(proposal, True)"
                     tal:attributes="class unread and 'unread listing_block' or 'listing_block'">
                    <tal:creators tal:replace="structure api.get_creators_info(proposal.creators, request)">Creators</tal:creators>
                    <span i18n:translate="">propose</span>:
                    <span class="body" tal:content="structure proposal.title">Title</span>
                    
                    <div tal:define="state_id proposal.get_workflow_state()">
                        <span i18n:translate="">State</span>:
                        <strong tal:attributes="class 'wf-state-%s' % state_id"
                              tal:content="state_id">private</strong>
                    </div>
                    <span class="time" tal:content="api.get_time_created(context)"></span>
                    <div tal:replace="structure api.get_action_bar(proposal, request)">Action bar</div>
                    <span class="expressions" tal:content="structure api.expressions.get_expressions(proposal, 'support', api.userid, 'Support')"></span>
                    <div class="clear"><!-- --></div>
                </div>
                
            </tal:iterate>
            
            <div tal:condition="proposal_form|False" tal:replace="structure proposal_form">Proposal form</div>
        </div>
    </div> <!-- left_content -->
</body>
</html>
