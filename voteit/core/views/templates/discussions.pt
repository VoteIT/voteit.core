<tal:main xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="voteit.core">
<!-- FIXME: Refactor and move! See components/proposals/listing.pt -->
<div class="listing">
	<div tal:condition="'tag' in request.GET"
	     class="tag-title listing_block listing_control">
	    <span i18n:translate="">Limited to <span i18n:name="tag_name" tal:content="'#'+request.GET.get('tag', '')"></span></span>
	    <a class="tag icon-right arrow-right" tal:attributes="href clear_tag_url"
	       i18n:translate="">
	        Show all posts
	    </a>
	    <div class="clear"><!-- --></div>
	</div>
	
	<tal:limit condition="'tag' not in request.GET">
		<div tal:condition="over_limit"
		     class="load_more listing_block listing_control">
		    <a class="icon-right arrow-right" tal:attributes="href more_url_all"
		       i18n:translate="">
		        Show
		        <span tal:content="over_limit" i18n:name="count">5</span>
		        previous posts
		    </a>
		</div>
		<div tal:condition="not limit"
		     class="load_more listing_block listing_control">
		    <a class="icon-right arrow-right" tal:attributes="href more_url_normal"
		       i18n:translate="">
		        Show the last 5 posts
		    </a>
		</div>
	</tal:limit>
	
	<tal:iterate condition="discussions" repeat="post discussions">
	    <div tal:define="unread api.is_brain_unread(post);
	    				 truncated truncate(post['title'], truncate_length)"
	         tal:attributes="class unread and 'unread listing_block' or 'listing_block';
			                 name post['name'];
			                 id post['uid'];">
	
	        <span tal:condition="api.show_moderator_actions" tal:replace="structure api.get_moderator_actions(post)">
	             Cogwheel menu
	        </span>
	
	        <tal:creators tal:replace="structure request.creators_info(post['creators'])">Creators</tal:creators>
	        <span class="body" tal:content="structure api.transform(truncated[0])">text</span>
	        <div class="more" tal:condition="truncated[1]">
	            <a class="icon-right arrow-right"
	               tal:attributes="href '%s%s/more' % (request.application_url, post['path'])"
	               i18n:translate="">Read more</a>
	        </div>
	        <tal:meta replace="structure api.render_single_view_component(context, request, 'main', 'metadata_listing', brain=post)">Meta</tal:meta>
	        <div class="clear"><!-- --></div>
	    </div>
	</tal:iterate>
    <!-- Load more - hidden at first -->
    <div class="listing_block load_new_ai_items">
        <a name="discussions" href="${request.url}" class="icon-right arrow-right"
           i18n:translate="">Load new discussion posts</a>
    </div>
</div> 
</tal:main>
