<tal:main xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="voteit.core" define="poll api.context">

    <div tal:define="poll_plugin poll.get_poll_plugin()|None;
                     wf_state poll.get_workflow_state();
                     can_vote api.context_has_permission('Add Vote', poll);
                     has_voted api.userid in poll;
                     proposals get_proposal_brains(poll.proposal_uids);"
         tal:attributes="class 'booth poll ' + poll.poll_plugin_name + ' ' + notify_delete(poll.proposal_uids);
                         name poll.__name__;
                         id poll.uid;
                         style 'position: absolute';">
                         
        <span class="close_wrapper">
        	<a href="#" class="close" title="Close" i18n:attributes="title">
        		<img src="${request.application_url}/static/icons/icon_close.png"
                     width="16" height="16"
                     alt="Close" i18n:attributes="alt" />
             </a>
        </span>

		<span tal:condition="api.show_moderator_actions" tal:replace="structure api.get_moderator_actions(poll)">
             Cogwheel menu
        </span>	

		<div class="wf_state">
		    <span class="iconpadding icon ${wf_state}">
		    ${api.tstring(poll.get_workflow_state().title())}
		    </span>
		</div>
		<h3 tal:content="poll.title">Title</h3>
		
		<div class="poll_wrapper">
			
			<div class="description"
	             tal:content="structure poll.description">
	                 Description</div>
			
			<tal:poll_ongoing condition="wf_state == 'ongoing' and can_vote and form" content="structure form">
				Form
			</tal:poll_ongoing>
			<div tal:condition="success_msg|False" class="success message">${success_msg}</div>
			<div class="error message"></div>
			<div class="col-65-35">
				<div class="column column-1">
			<tal:iterate condition="wf_state == 'ongoing' and not can_vote" repeat="proposal proposals">
			    <tal:proposal replace="structure api.render_single_view_component(context, request, 'proposal', 'block', brain=proposal)">
			    	Proposal
			    </tal:proposal>
			</tal:iterate>
				</div>
			</div>
			
			<tal:poll_closed condition="wf_state == 'closed'">
				<div tal:condition="has_voted and poll_plugin" tal:content="structure form">Render your vote</div>
			</tal:poll_closed>
			<div class="clear"><!-- --></div>
		</div>
		
		<div class="clear"><!-- --></div>
		
		<div class="poll_footer">
			<tal:poll_closed condition="wf_state == 'closed'">
			
				<div class="result" 
			            tal:content="structure poll.render_poll_result(request, api)">
			        	    Poll result</div>
			</tal:poll_closed>
			
			<div class="clear"><!-- --></div>
		
			<div class="iconpadding icon time start" 
		         tal:define="start_time api.dt_util.dt_format(poll.start_time)">
		        <span tal:condition="wf_state in ('private', 'upcoming', )"
		            i18n:translate="">
		            Starts <span tal:replace="start_time" i18n:name="start_time" />
		        </span>
		        <span tal:condition="wf_state in ('ongoing', 'closed', 'canceled')"
		            i18n:translate="">
		            Started <span tal:replace="start_time" i18n:name="start_time" />
		        </span>
		    </div>
		    <div class="iconpadding icon time end"
		         tal:define="end_time api.dt_util.dt_format(poll.end_time)">
		        <span tal:condition="wf_state in ('private', 'upcoming', 'ongoing', )"
		              i18n:translate="">
		              Closes <span tal:replace="end_time" i18n:name="end_time" />
		          </span>
		        <span tal:condition="wf_state in ('closed', 'canceled')"
		            i18n:translate="">
		            Closed <span tal:replace="end_time" i18n:name="end_time" />
		        </span>
		    </div>
		    
		    <div class="clear"><!-- --></div>
		    
		    <div>
				<strong i18n:translate="">Poll method</strong>: <span tal:content="poll_plugin.title|string:Broken plugin">Title</span>
		     	<p tal:content="structure poll_plugin.description|string:">Description</p>
	     	</div>
		</div>

    </div>
    
</tal:main>
