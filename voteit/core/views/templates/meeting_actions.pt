<tal:main xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="voteit.core">

<ul id="meeting-actions-menu">
    <li class="tab dropdown_menu" tal:condition="api.meeting">
        <a href="#" class="menu_header">
            <span class="iconpadding poll-dark">
                <span>
                    <tal:unread condition="unread_polls_count">(${unread_polls_count})</tal:unread>
                    <tal:polls i18n:translate="">Polls</tal:polls> &raquo;
                </span>
            </span>
        </a>
        <ul class="menu_body">
            <tal:polls condition="show_polls">
                <tal:section repeat="section sections">
                    <tal:defs define="metadatas polls_metadata[section]">
                    <tal:exists condition="metadatas">
                        <li class="readonly iconpadding ${section}"><span>${api.translate(section.title())}</span></li>
                        <li tal:repeat="poll_metadata metadatas">
                            <a href="${poll_metadata['path']}"
                               tal:attributes="class api.userid in poll_metadata.get('unread',()) and 'unread' or ''">
                                <tal:not_voted condition="api.userid not in poll_metadata['voted_userids']">*</tal:not_voted>
                                ${poll_metadata['title']}
                            </a>
                        </li>
                    </tal:exists>
                    </tal:defs>
                </tal:section>
                <li class="meta"><br/>
                    * <span i18n:translate="">means you've not voted in that poll.</span>
                </li>
            </tal:polls>
            <li tal:condition="not show_polls" i18n:translate="">(No polls yet)</li>
        </ul>
    </li>
    
    <tal:meeting condition="api.meeting and is_moderator">
        <li class="tab dropdown_menu">
            <a href="#" class="menu_header iconpadding">
                <span class="cog-dark" i18n:translate="">Moderator menu</span> &raquo;
            </a>
            <ul class="menu_body">
                <li>
                    <a tal:attributes="href api.resource_url(api.meeting, request) + '@@permissions'"
                        i18n:translate="">Edit permissions</a>
                </li>
                <li tal:condition="context.get_workflow_state() != 'private'">
                    <a tal:attributes="href api.resource_url(api.meeting, request) + '@@add_tickets'"
                       i18n:translate="">Invite participants</a>
                </li>
                <li tal:condition="context.get_workflow_state() != 'private'">
                    <a tal:attributes="href api.resource_url(api.meeting, request) + '@@manage_tickets'"
                       i18n:translate="">Manage invites</a>
                </li>
                <li>
                    <a tal:attributes="href api.resource_url(api.meeting, request) + '@@logs'"
                       i18n:translate="">Meeting actions log</a>
                </li>
            </ul>
        </li>
    </tal:meeting>
    
    <tal:meeting_menu condition="meetings|False">
        <li class="tab dropdown_menu">
            <a href="#" class="menu_header"><span i18n:translate="">Meetings</span> &raquo;</a>
            <ul class="menu_body">
                <tal:iterate repeat="meeting meetings">
                    <li>
                        <a tal:attributes="href api.resource_url(meeting, request)">
                            <tal:current condition="api.meeting == meeting">*</tal:current>
                            ${meeting.title}
                        </a>
                    </li>
                </tal:iterate>
            </ul>
        </li>
    </tal:meeting_menu>

    <tal:participants condition="api.userid and api.meeting">
        <li class="tab">
            <a tal:attributes="href '%s@@participants' % api.resource_url(api.meeting, request);"
                       i18n:translate="">Participants</a>
        </li>
    </tal:participants>
    
    <tal:root condition="is_moderator and api.meeting is None">
        <li class="tab dropdown_menu">
            <a href="#" class="menu_header iconpadding">
                <span class="cog-dark" i18n:translate="">Admin menu</span> &raquo;
            </a>
            <ul class="menu_body">
                <li>
                    <a tal:attributes="href api.resource_url(api.root, request) + '@@permissions'"
                        i18n:translate="">Edit permissions</a>
                </li>
                <li tal:condition="api.context_has_permission('Manage Server', context)">
                    <a tal:attributes="href api.resource_url(context, request) + '@@server_logs'"
                       i18n:translate="">Server logs</a>
                </li>
            </ul>
        </li>

    </tal:root>
    
</ul>
</tal:main>
