<tal:block tal:omit-tag="" xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="deform">
  <textarea id="${field.oid}" name="${field.name}" class='tinymce' tal:content="structure cstruct" />
  <span id="${field.oid}-preload" class="tinymce-preload" tal:content="structure cstruct" />
  <script language="javascript" type="text/javascript">
    (function($){
      deform.addCallback('${field.oid}', function(oid) {
        var jqoid = $('#' + oid);
        var jqoid_preload = $('#' + oid + '-preload');
        jqoid.hide();
        jqoid_preload.click(function(){
          jqoid.show();
          jqoid_preload.remove();
          tinyMCE.init({
          mode : 'exact',
          language: '<tal:block i18n:translate="language-code">en</tal:block>',
          elements: oid,
          height: '${field.widget.height}',
          width: '${field.widget.width}',
          skin: '${field.widget.skin}',
          plugins : "fullscreen,media",
          relative_urls : false,
          remove_script_host : true,
          theme_advanced_resizing : true,
          theme_advanced_statusbar_location: 'bottom',
          theme_advanced_toolbar_align : 'left',
          theme_advanced_toolbar_location : 'top',
          theme : "advanced",
          theme_advanced_buttons1 : "formatselect,bold,italic,underline,separator,justifyleft,justifycenter,justifyright,justifyfull,separator,bullist,numlist,separator,undo,redo,separator,link,unlink,image,media,separator,removeformat,cleanup,code,separator,fullscreen",
          theme_advanced_buttons2 : "",
          theme_advanced_buttons3 : "",
          theme_advanced_blockformats : "p,h1,h2,h3,h4,h5,h6,blockquote",
          invalid_elements: "textarea,select,option,input,button,script",
          valid_elements : "@[id|class|style|title|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|"
                            + "onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|"
                            + "onkeydown|onkeyup],a[rel|rev|charset|hreflang|tabindex|accesskey|type|"
                            + "name|href|target|title|class|onfocus|onblur],strong/b,em/i,strike,u,"
                            + "#p,-ol[type|compact],-ul[type|compact],-li,br,img[longdesc|usemap|"
                            + "src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,"
                            + "-blockquote,-table[border=0|cellspacing|cellpadding|width|frame|rules|"
                            + "height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|"
                            + "height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,"
                            + "#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor"
                            + "|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,-div,"
                            + "-span,-code,-pre,address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face"
                            + "|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],"
                            + "object[classid|width|height|codebase|*],param[name|value|_value],embed[type|width"
                            + "|height|src|*],map[name],area[shape|coords|href|alt|target],bdo,"
                            + "col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|"
                            + "valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],"
                            + "kbd,label[for],legend,noscript,optgroup[label|disabled],"
                            + "q[cite],samp,small,"
                            + "tt,var,big"
          });
          jqoid_preload.unbind('click');
        });
        if (!${str(bool(field.widget.delayed_load)).lower()}) {
          jqoid_preload.click();
        }
      });
      $().bind('form.pre.serialize', function(event, $form, options) {
        tinyMCE.triggerSave();
      });
    })(jQuery);
  </script>
</tal:block>
