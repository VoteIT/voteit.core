<metal:main define-macro="navigation"
            xmlns:i18n="http://xml.zope.org/namespaces/i18n"
            i18n:domain="voteit.core">

    <tal:root condition="not api.meeting">
    <div class="block">
    <div id="add_menu" tal:condition="api.context_has_permission('Add Meeting', api.root)">
        <a tal:attributes="href api.resource_url(api.root, request) + '@@add?content_type=Meeting'">
        	<img src="${request.application_url}/static/images/plus.png" alt="Add meeting" title="Add meeting" i18n:attributes="alt title" />
		</a>
    </div>
    <h5 class="header" i18n:translate="">Available meetings</h5>
    <tal:iterate repeat="meeting api.get_restricted_content(api.root, content_type='Meeting')">
        <h6>
            <a tal:attributes="href api.resource_url(meeting, request)"
               tal:content="meeting.get_field_value('title')">Meeting title</a>
        </h6>
        
    </tal:iterate>
	</div>
    </tal:root>

    <tal:inside_meeting condition="api.meeting">
        <div class="block">
            <a tal:attributes="href api.resource_url(api.root, request)">
                &laquo; <span i18n:translate="">all meetings</span>
            </a>
        </div>
        <div class="block">
        <div id="add_menu" tal:condition="is_moderator">
            <a tal:attributes="href api.resource_url(api.meeting, request) + '@@add?content_type=AgendaItem'">
            	<img src="${request.application_url}/static/images/plus.png" alt="Add agenda item" title="Add agenda item" i18n:attributes="alt title" />
			</a>
        </div>
        <h5 class="header" i18n:translate="">
            Agenda
        </h5>
		</div>
        <tal:iterate repeat="section sections">
            <tal:agenda_items define="agenda_items api.get_restricted_content(api.meeting, content_type='AgendaItem', states=section);">
                <div tal:attributes="id '%s-%s' % (api.meeting.uid, section);
                                     class is_closed('%s-%s' % (api.meeting.uid, section)) and 'closed-element minimizable_area block' or 'opened-element minimizable_area block';">
                    <h6 tal:attributes="class 'toggle_minimize %s' % section">
                    	<span tal:content="api.translate(section.title())">Section title</span>
					</h6>
					
                    <ul tal:attributes="class section" tal:condition="agenda_items">
                    <tal:iterate repeat="agenda_item agenda_items">
                        <li tal:attributes="class api.inside(context, agenda_item) and 'selected' or 'plain'">
                        	<tal:moderator_menu condition="is_moderator">
	                        	<span tal:replace="structure api.get_moderator_actions(agenda_item, request)">
								     Cogwheel menu
								</span>
							</tal:moderator_menu>
							<div class="agenda_item">
	                            <a tal:attributes="href api.resource_url(agenda_item, request)">
	                                <div tal:content="agenda_item.get_field_value('title')">Agenda item title</div>
	                                <span class="discussions"
									      tal:define="unread_count api.get_unread(agenda_item, content_type='DiscussionPost')">
										<span class="total"
										      tal:content="len(agenda_item.get_content(content_type='DiscussionPost'))">0</span>
									    <span class="unread" tal:condition="unread_count" tal:content="string:($unread_count)">(2)</span>
									</span>
	                                <span class="proposals"
	                                      tal:define="unread_count api.get_unread(agenda_item, content_type='Proposal')">
										<span class="total"
										      tal:content="len(agenda_item.get_content(content_type='Proposal'))">0</span>
	                                    <span class="unread" tal:condition="unread_count" tal:content="string:($unread_count)">(2)</span>
									</span>
									<div class="clear"><!-- --></div>
	                            </a>
							</div>
                        </li>
                    </tal:iterate>
                    </ul>
					
                </div>
            </tal:agenda_items>

        </tal:iterate>
    </tal:inside_meeting>

</metal:main>
