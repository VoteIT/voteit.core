<tal:main xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="voteit.core">
<nav id="fixed-top-nav" class="navbar-fixed-top">
    <div class="container-fluid" data-check-greedy>

      <a class="voteit-logo-nav pull-left" href="${request.application_url}"></a>

      <a class="text-overflow voteit-nav-header pull-left greedy" tal:condition="request.meeting"
         href="${request.resource_url(request.meeting)}">
          ${request.meeting.nav_title and request.meeting.nav_title or request.meeting.title}
      </a>

      <tal:def define="navobjs request.meeting is None and tuple(view.get_local_nav_objects(view.root)) or ()">
        <ul tal:condition="navobjs" class="nav voteit-nav pull-left">
          <li tal:repeat="obj navobjs">
            <a href="${request.resource_url(obj)}">${obj.get_nav_title()|obj.title}</a>
          </li>
        </ul>
      </tal:def>

      <ul class="nav voteit-nav pull-right"
          tal:define="umcontxt request.meeting and request.meeting or request.root">
        <tal:unauthenticated condition="not request.authenticated_userid">
          ${structure: view.render_view_group('nav_right')}
        </tal:unauthenticated>

        <li>
          <a data-initiator="#help-menu"
             data-actionmarker="disabled"
             href="#"
             tal:define="help_menu_url request.resource_url(umcontxt, '_help_menu');"
             onclick="javascript:voteit.load_inline_menu('#help-menu', '${help_menu_url}')">
            <span data-actionmarker="rotate-me glyphicon-refresh"
                  class="glyphicon glyphicon-question-sign"></span>
            <span class="hidden-xs hidden-sm" i18n:translate="">Help</span>
            <span class="caret"></span>
          </a>
        </li>

        <li tal:condition="request.authenticated_userid">
          <a tal:define="usr_menu_url request.resource_url(umcontxt, '_user_menu')"
             data-initiator="#user-menu"
             data-actionmarker="disabled"
             href="#"
             onclick="javascript:voteit.load_inline_menu('#user-menu', '${usr_menu_url}')">
            <span data-actionmarker="rotate-me glyphicon-refresh" class="glyphicon glyphicon-user"></span>
            <span class="hidden-xs hidden-sm">${request.authenticated_userid}</span>
            <span class="caret"></span>
          </a>
        </li>

        <li tal:condition="request.is_moderator">
          <a data-initiator="#site-menu"
             data-actionmarker="disabled"
             tal:define="site_url request.resource_url(request.root, '_site_menu');"
              href="#"
              onclick="javascript:voteit.load_inline_menu('#site-menu', '${site_url}')">
            <span data-actionmarker="rotate-me glyphicon-refresh" class="glyphicon glyphicon-cog"></span>
            <span class="hidden-xs hidden-sm" i18n:translate="">Site</span>
            <span class="caret"></span>
          </a>
        </li>
      </ul>
    </div><!-- /.container-->

  <tal:meeting_nav tal:condition="request.is_participant">

    <div>
      <div class="pull-left">
        <ul class="nav voteit-nav agenda-responsive-width">
          <li>
            <a href="#"
               onclick="javascript:voteit.toggle_agenda()">
              &nbsp;
              <span class="glyphicon glyphicon-list"></span>
              &nbsp;
            </a>
          </li>
        </ul>
      </div>
      <div class="pull-left">
        <ul class="nav voteit-nav">

          <li>
            <a data-initiator="#poll-menu"
               data-actionmarker="disabled"
               href="#"
               tal:define="poll_menu_url request.resource_url(request.meeting, '_poll_menu');"
               onclick="javascript:voteit.load_inline_menu('#poll-menu', '${poll_menu_url}')">
              <span data-actionmarker="rotate-me glyphicon-refresh" class="glyphicon glyphicon-star"></span>
              <span class="hidden-xs hidden-sm" i18n:translate="">Polls</span>
              <span class="label label-success" data-important-polls></span>
              <span class="caret"></span>
            </a>
          </li>

          <li>
            <a href="${request.resource_url(request.meeting, 'participants')}">
              <span class="glyphicon glyphicon-user"></span>
              <span class="hidden-xs hidden-sm" i18n:translate="">Participants</span>
            </a>
          </li>

          <li>
            <a href="${request.resource_url(request.meeting, 'minutes')}">
              <span class="glyphicon glyphicon-file"></span>
              <span class="hidden-xs hidden-sm" i18n:translate="">Minutes</span>
            </a>
          </li>

          <li tal:condition="request.is_moderator">
            <a data-initiator="#control-panel"
               data-actionmarker="disabled"
               href="#"
               tal:define="url request.resource_url(request.meeting, '_control_panel');"
               onclick="javascript:voteit.load_inline_menu('#control-panel', '${url}')">
              <span data-actionmarker="rotate-me glyphicon-refresh" class="glyphicon glyphicon-cog"></span>
              <span class="hidden-xs hidden-sm" i18n:translate="">Control panel</span>
              <span class="caret"></span>
            </a>
          </li>

          ${structure: view.render_view_group('nav_meeting')|''}

          <!-- XXX -->
          <li tal:condition="False |request.is_moderator">
            FIXME: This will be the catch-all menu for things that doesn't fit in nav_meeting

            <a data-initiator="#site-menu"
               data-actionmarker="disabled"
               tal:define="m_context request.meeting and request.meeting or request.root;
                            site_url request.resource_url(m_context, '_site_menu');"
                href="#"
                onclick="javascript:voteit.load_inline_menu('#site-menu', '${site_url}')">
              <span data-actionmarker="rotate-me">
                    &#8942;
              </span>
            </a>
          </li>

        </ul>
      </div>
    </div><!-- /.container-->
  </tal:meeting_nav>

  <div class="container container-float-below">
    <div class="float-below" data-flash-slot="voteit-main"></div>
  </div>
</nav>
</tal:main>
